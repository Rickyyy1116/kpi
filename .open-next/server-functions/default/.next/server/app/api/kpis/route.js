(()=>{var e={};e.id=275,e.ids=[275],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},83283:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>N,routeModule:()=>q,serverHooks:()=>k,workAsyncStorage:()=>y,workUnitAsyncStorage:()=>w});var s={};r.r(s),r.d(s,{GET:()=>m,POST:()=>f});var a=r(75224),i=r(91133),n=r(65612),o=r(72529),d=r(23625),u=r(45618),l=r(14937),c=r(49814),p=r(68919);async function m(e){try{let t;let{searchParams:r}=new URL(e.url),s=r.get("goalId"),a=await (0,c.LE)(),i=process.env,n=(0,d.L)(i.DB);return await (0,c.Co)(n,a),t=s?await n.query.kpis.findMany({where:(0,p.eq)(u.kpis.goalId,s)}):await n.query.kpis.findMany(),o.NextResponse.json({kpis:t})}catch(e){return console.error("GET /api/kpis error:",e),o.NextResponse.json({error:"Failed to fetch KPIs"},{status:500})}}async function f(e){try{let{goalId:t,title:r,description:s,targetValue:a,unit:i,direction:n,frequency:m,ownerId:f}=await e.json();if(!t||!r||!a||!i||!n||!m||!f)return o.NextResponse.json({error:"Missing required fields"},{status:400});if(!["up","down"].includes(n))return o.NextResponse.json({error:"Invalid direction"},{status:400});if(!["daily","weekly","monthly"].includes(m))return o.NextResponse.json({error:"Invalid frequency"},{status:400});if(0>=Number(a))return o.NextResponse.json({error:"Target value must be greater than 0"},{status:400});let q=await (0,c.LE)(),y=process.env,w=(0,d.L)(y.DB),k=await (0,c.Co)(w,q),N=await w.query.goals.findFirst({where:(0,p.eq)(u.goals.id,t)});if(!N||N.teamId!==k)return o.NextResponse.json({error:"Goal not found or forbidden"},{status:403});let g={id:(0,l.Ak)(),goalId:t,title:r,description:s||null,ownerId:f,targetValue:Number(a),unit:i,direction:n,frequency:m,weight:1,status:"active"};return await w.insert(u.kpis).values(g),o.NextResponse.json({kpi:g},{status:201})}catch(e){return console.error("POST /api/kpis error:",e),o.NextResponse.json({error:"Failed to create KPI"},{status:500})}}let q=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/kpis/route",pathname:"/api/kpis",filename:"route",bundlePath:"app/api/kpis/route"},resolvedPagePath:"/Users/kawashimariku/Desktop/KPI管理/src/app/api/kpis/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:y,workUnitAsyncStorage:w,serverHooks:k}=q;function N(){return(0,n.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:w})}},84455:()=>{},14719:()=>{},23625:(e,t,r)=>{"use strict";r.d(t,{L:()=>i});var s=r(66388),a=r(45618);function i(e){return(0,s.f)(e,{schema:a})}},45618:(e,t,r)=>{"use strict";r.r(t),r.d(t,{goals:()=>p,goalsRelations:()=>q,kpiUpdates:()=>f,kpiUpdatesRelations:()=>w,kpis:()=>m,kpisRelations:()=>y,teamMembers:()=>c,teamMembersRelations:()=>k,teams:()=>l,users:()=>u});var s=r(16620),a=r(18762),i=r(42787),n=r(5737),o=r(18884),d=r(75888);let u=(0,s.D)("users",{id:(0,a.Qq)("id").primaryKey(),email:(0,a.Qq)("email").notNull().unique(),name:(0,a.Qq)("name").notNull(),avatarUrl:(0,a.Qq)("avatar_url"),createdAt:(0,i.nd)("created_at",{mode:"timestamp_ms"}).default((0,o.ll)`CURRENT_TIMESTAMP`)}),l=(0,s.D)("teams",{id:(0,a.Qq)("id").primaryKey(),name:(0,a.Qq)("name").notNull(),createdAt:(0,i.nd)("created_at",{mode:"timestamp_ms"}).default((0,o.ll)`CURRENT_TIMESTAMP`)}),c=(0,s.D)("team_members",{id:(0,a.Qq)("id").primaryKey(),teamId:(0,a.Qq)("team_id").notNull().references(()=>l.id),userId:(0,a.Qq)("user_id").notNull().references(()=>u.id),role:(0,a.Qq)("role",{enum:["owner","member"]}).notNull()}),p=(0,s.D)("goals",{id:(0,a.Qq)("id").primaryKey(),teamId:(0,a.Qq)("team_id").notNull().references(()=>l.id),title:(0,a.Qq)("title").notNull(),description:(0,a.Qq)("description"),ownerId:(0,a.Qq)("owner_id").notNull().references(()=>u.id),targetValue:(0,n.x)("target_value").notNull(),unit:(0,a.Qq)("unit").notNull(),dueDate:(0,i.nd)("due_date"),status:(0,a.Qq)("status",{enum:["active","archived"]}).default("active"),createdAt:(0,i.nd)("created_at",{mode:"timestamp_ms"}).default((0,o.ll)`CURRENT_TIMESTAMP`)}),m=(0,s.D)("kpis",{id:(0,a.Qq)("id").primaryKey(),goalId:(0,a.Qq)("goal_id").notNull().references(()=>p.id),title:(0,a.Qq)("title").notNull(),description:(0,a.Qq)("description"),ownerId:(0,a.Qq)("owner_id").notNull().references(()=>u.id),targetValue:(0,n.x)("target_value").notNull(),unit:(0,a.Qq)("unit").notNull(),direction:(0,a.Qq)("direction",{enum:["up","down"]}).notNull(),frequency:(0,a.Qq)("frequency",{enum:["daily","weekly","monthly"]}).notNull(),weight:(0,n.x)("weight").default(1),status:(0,a.Qq)("status",{enum:["active","archived"]}).default("active"),createdAt:(0,i.nd)("created_at",{mode:"timestamp_ms"}).default((0,o.ll)`CURRENT_TIMESTAMP`)}),f=(0,s.D)("kpi_updates",{id:(0,a.Qq)("id").primaryKey(),kpiId:(0,a.Qq)("kpi_id").notNull().references(()=>m.id),value:(0,n.x)("value").notNull(),note:(0,a.Qq)("note"),recordedAt:(0,i.nd)("recorded_at",{mode:"timestamp_ms"}).notNull(),createdBy:(0,a.Qq)("created_by").notNull().references(()=>u.id)}),q=(0,d.K1)(p,({one:e,many:t})=>({team:e(l,{fields:[p.teamId],references:[l.id]}),owner:e(u,{fields:[p.ownerId],references:[u.id]}),kpis:t(m)})),y=(0,d.K1)(m,({one:e,many:t})=>({goal:e(p,{fields:[m.goalId],references:[p.id]}),owner:e(u,{fields:[m.ownerId],references:[u.id]}),updates:t(f)})),w=(0,d.K1)(f,({one:e})=>({kpi:e(m,{fields:[f.kpiId],references:[m.id]}),creator:e(u,{fields:[f.createdBy],references:[u.id]})})),k=(0,d.K1)(c,({one:e})=>({team:e(l,{fields:[c.teamId],references:[l.id]}),user:e(u,{fields:[c.userId],references:[u.id]})}))},49814:(e,t,r)=>{"use strict";r.d(t,{Co:()=>o,LE:()=>n});var s=r(45618),a=r(68919);let i={A:"user_a"};async function n(){return i.A}async function o(e,t){let r=await e.query.teamMembers.findFirst({where:(0,a.eq)(s.teamMembers.userId,t)});return r?r.teamId:"team_default"}},14937:(e,t,r)=>{"use strict";let s,a;r.d(t,{Ak:()=>n});let i=require("node:crypto");function n(e=21){var t;t=e|=0,!s||s.length<t?(s=Buffer.allocUnsafe(128*t),i.webcrypto.getRandomValues(s),a=0):a+t>s.length&&(i.webcrypto.getRandomValues(s),a=0),a+=t;let r="";for(let t=a-e;t<a;t++)r+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&s[t]];return r}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[442,928,87,388],()=>r(83283));module.exports=s})();