(()=>{var e={};e.id=166,e.ids=[166],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64539:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>v,routeModule:()=>f,serverHooks:()=>N,workAsyncStorage:()=>q,workUnitAsyncStorage:()=>y});var a={};r.r(a),r.d(a,{DELETE:()=>m,PATCH:()=>c});var s=r(75224),i=r(91133),d=r(65612),n=r(72529),o=r(23625),u=r(45618),l=r(49814),p=r(68919);async function c(e,{params:t}){try{let{id:r}=await t,a=await e.json(),s=await (0,l.LE)(),i=process.env,d=(0,o.L)(i.DB),c=await d.query.kpiUpdates.findFirst({where:(0,p.eq)(u.kpiUpdates.id,r)});if(!c)return n.NextResponse.json({error:"Update not found"},{status:404});if(c.createdBy!==s)return n.NextResponse.json({error:"Forbidden"},{status:403});let m={};return void 0!==a.value&&(m.value=Number(a.value)),void 0!==a.note&&(m.note=a.note),void 0!==a.recordedAt&&(m.recordedAt=Number(a.recordedAt)),await d.update(u.kpiUpdates).set(m).where((0,p.eq)(u.kpiUpdates.id,r)),n.NextResponse.json({ok:!0})}catch(e){return console.error("PATCH /api/updates/:id error:",e),n.NextResponse.json({error:"Failed to update"},{status:500})}}async function m(e,{params:t}){try{let{id:e}=await t,r=await (0,l.LE)(),a=process.env,s=(0,o.L)(a.DB),i=await s.query.kpiUpdates.findFirst({where:(0,p.eq)(u.kpiUpdates.id,e)});if(!i)return n.NextResponse.json({error:"Update not found"},{status:404});if(i.createdBy!==r)return n.NextResponse.json({error:"Forbidden"},{status:403});return await s.delete(u.kpiUpdates).where((0,p.eq)(u.kpiUpdates.id,e)),n.NextResponse.json({ok:!0})}catch(e){return console.error("DELETE /api/updates/:id error:",e),n.NextResponse.json({error:"Failed to delete update"},{status:500})}}let f=new s.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/updates/[id]/route",pathname:"/api/updates/[id]",filename:"route",bundlePath:"app/api/updates/[id]/route"},resolvedPagePath:"/Users/kawashimariku/Desktop/KPI管理/src/app/api/updates/[id]/route.ts",nextConfigOutput:"standalone",userland:a}),{workAsyncStorage:q,workUnitAsyncStorage:y,serverHooks:N}=f;function v(){return(0,d.patchFetch)({workAsyncStorage:q,workUnitAsyncStorage:y})}},84455:()=>{},14719:()=>{},23625:(e,t,r)=>{"use strict";r.d(t,{L:()=>i});var a=r(66388),s=r(45618);function i(e){return(0,a.f)(e,{schema:s})}},45618:(e,t,r)=>{"use strict";r.r(t),r.d(t,{goals:()=>c,goalsRelations:()=>q,kpiUpdates:()=>f,kpiUpdatesRelations:()=>N,kpis:()=>m,kpisRelations:()=>y,teamMembers:()=>p,teamMembersRelations:()=>v,teams:()=>l,users:()=>u});var a=r(16620),s=r(18762),i=r(42787),d=r(5737),n=r(18884),o=r(75888);let u=(0,a.D)("users",{id:(0,s.Qq)("id").primaryKey(),email:(0,s.Qq)("email").notNull().unique(),name:(0,s.Qq)("name").notNull(),avatarUrl:(0,s.Qq)("avatar_url"),createdAt:(0,i.nd)("created_at",{mode:"timestamp_ms"}).default((0,n.ll)`CURRENT_TIMESTAMP`)}),l=(0,a.D)("teams",{id:(0,s.Qq)("id").primaryKey(),name:(0,s.Qq)("name").notNull(),createdAt:(0,i.nd)("created_at",{mode:"timestamp_ms"}).default((0,n.ll)`CURRENT_TIMESTAMP`)}),p=(0,a.D)("team_members",{id:(0,s.Qq)("id").primaryKey(),teamId:(0,s.Qq)("team_id").notNull().references(()=>l.id),userId:(0,s.Qq)("user_id").notNull().references(()=>u.id),role:(0,s.Qq)("role",{enum:["owner","member"]}).notNull()}),c=(0,a.D)("goals",{id:(0,s.Qq)("id").primaryKey(),teamId:(0,s.Qq)("team_id").notNull().references(()=>l.id),title:(0,s.Qq)("title").notNull(),description:(0,s.Qq)("description"),ownerId:(0,s.Qq)("owner_id").notNull().references(()=>u.id),targetValue:(0,d.x)("target_value").notNull(),unit:(0,s.Qq)("unit").notNull(),dueDate:(0,i.nd)("due_date"),status:(0,s.Qq)("status",{enum:["active","archived"]}).default("active"),createdAt:(0,i.nd)("created_at",{mode:"timestamp_ms"}).default((0,n.ll)`CURRENT_TIMESTAMP`)}),m=(0,a.D)("kpis",{id:(0,s.Qq)("id").primaryKey(),goalId:(0,s.Qq)("goal_id").notNull().references(()=>c.id),title:(0,s.Qq)("title").notNull(),description:(0,s.Qq)("description"),ownerId:(0,s.Qq)("owner_id").notNull().references(()=>u.id),targetValue:(0,d.x)("target_value").notNull(),unit:(0,s.Qq)("unit").notNull(),direction:(0,s.Qq)("direction",{enum:["up","down"]}).notNull(),frequency:(0,s.Qq)("frequency",{enum:["daily","weekly","monthly"]}).notNull(),weight:(0,d.x)("weight").default(1),status:(0,s.Qq)("status",{enum:["active","archived"]}).default("active"),createdAt:(0,i.nd)("created_at",{mode:"timestamp_ms"}).default((0,n.ll)`CURRENT_TIMESTAMP`)}),f=(0,a.D)("kpi_updates",{id:(0,s.Qq)("id").primaryKey(),kpiId:(0,s.Qq)("kpi_id").notNull().references(()=>m.id),value:(0,d.x)("value").notNull(),note:(0,s.Qq)("note"),recordedAt:(0,i.nd)("recorded_at",{mode:"timestamp_ms"}).notNull(),createdBy:(0,s.Qq)("created_by").notNull().references(()=>u.id)}),q=(0,o.K1)(c,({one:e,many:t})=>({team:e(l,{fields:[c.teamId],references:[l.id]}),owner:e(u,{fields:[c.ownerId],references:[u.id]}),kpis:t(m)})),y=(0,o.K1)(m,({one:e,many:t})=>({goal:e(c,{fields:[m.goalId],references:[c.id]}),owner:e(u,{fields:[m.ownerId],references:[u.id]}),updates:t(f)})),N=(0,o.K1)(f,({one:e})=>({kpi:e(m,{fields:[f.kpiId],references:[m.id]}),creator:e(u,{fields:[f.createdBy],references:[u.id]})})),v=(0,o.K1)(p,({one:e})=>({team:e(l,{fields:[p.teamId],references:[l.id]}),user:e(u,{fields:[p.userId],references:[u.id]})}))},49814:(e,t,r)=>{"use strict";r.d(t,{Co:()=>n,LE:()=>d});var a=r(45618),s=r(68919);let i={A:"user_a"};async function d(){return i.A}async function n(e,t){let r=await e.query.teamMembers.findFirst({where:(0,s.eq)(a.teamMembers.userId,t)});return r?r.teamId:"team_default"}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[442,928,87,388],()=>r(64539));module.exports=a})();