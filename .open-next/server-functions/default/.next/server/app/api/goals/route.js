(()=>{var e={};e.id=302,e.ids=[302],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},98348:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>v,routeModule:()=>q,serverHooks:()=>N,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>y});var a={};r.r(a),r.d(a,{GET:()=>m,POST:()=>f});var s=r(75224),i=r(91133),n=r(65612),o=r(72529),d=r(23625),l=r(45618),u=r(14937),c=r(49814),p=r(68919);async function m(e){try{let e=await (0,c.LE)(),t=process.env,r=(0,d.L)(t.DB),a=await (0,c.Co)(r,e),s=await r.query.goals.findMany({where:(0,p.eq)(l.goals.teamId,a),orderBy:(e,{desc:t})=>[t(e.createdAt)]});return o.NextResponse.json({goals:s})}catch(e){return console.error("GET /api/goals error:",e),o.NextResponse.json({error:"Failed to fetch goals"},{status:500})}}async function f(e){try{let{title:t,description:r,targetValue:a,unit:s,dueDate:i,ownerId:n}=await e.json();if(!t||!a||!s||!n)return o.NextResponse.json({error:"Missing required fields"},{status:400});let p=await (0,c.LE)(),m=process.env,f=(0,d.L)(m.DB),q=await (0,c.Co)(f,p),g={id:(0,u.Ak)(),teamId:q,title:t,description:r||null,ownerId:n,targetValue:Number(a),unit:s,dueDate:i?Number(i):null,status:"active"};return await f.insert(l.goals).values(g),o.NextResponse.json({goal:g},{status:201})}catch(e){return console.error("POST /api/goals error:",e),o.NextResponse.json({error:"Failed to create goal"},{status:500})}}let q=new s.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/goals/route",pathname:"/api/goals",filename:"route",bundlePath:"app/api/goals/route"},resolvedPagePath:"/Users/kawashimariku/Desktop/KPI管理/src/app/api/goals/route.ts",nextConfigOutput:"standalone",userland:a}),{workAsyncStorage:g,workUnitAsyncStorage:y,serverHooks:N}=q;function v(){return(0,n.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:y})}},84455:()=>{},14719:()=>{},23625:(e,t,r)=>{"use strict";r.d(t,{L:()=>i});var a=r(66388),s=r(45618);function i(e){return(0,a.f)(e,{schema:s})}},45618:(e,t,r)=>{"use strict";r.r(t),r.d(t,{goals:()=>p,goalsRelations:()=>q,kpiUpdates:()=>f,kpiUpdatesRelations:()=>y,kpis:()=>m,kpisRelations:()=>g,teamMembers:()=>c,teamMembersRelations:()=>N,teams:()=>u,users:()=>l});var a=r(16620),s=r(18762),i=r(42787),n=r(5737),o=r(18884),d=r(75888);let l=(0,a.D)("users",{id:(0,s.Qq)("id").primaryKey(),email:(0,s.Qq)("email").notNull().unique(),name:(0,s.Qq)("name").notNull(),avatarUrl:(0,s.Qq)("avatar_url"),createdAt:(0,i.nd)("created_at",{mode:"timestamp_ms"}).default((0,o.ll)`CURRENT_TIMESTAMP`)}),u=(0,a.D)("teams",{id:(0,s.Qq)("id").primaryKey(),name:(0,s.Qq)("name").notNull(),createdAt:(0,i.nd)("created_at",{mode:"timestamp_ms"}).default((0,o.ll)`CURRENT_TIMESTAMP`)}),c=(0,a.D)("team_members",{id:(0,s.Qq)("id").primaryKey(),teamId:(0,s.Qq)("team_id").notNull().references(()=>u.id),userId:(0,s.Qq)("user_id").notNull().references(()=>l.id),role:(0,s.Qq)("role",{enum:["owner","member"]}).notNull()}),p=(0,a.D)("goals",{id:(0,s.Qq)("id").primaryKey(),teamId:(0,s.Qq)("team_id").notNull().references(()=>u.id),title:(0,s.Qq)("title").notNull(),description:(0,s.Qq)("description"),ownerId:(0,s.Qq)("owner_id").notNull().references(()=>l.id),targetValue:(0,n.x)("target_value").notNull(),unit:(0,s.Qq)("unit").notNull(),dueDate:(0,i.nd)("due_date"),status:(0,s.Qq)("status",{enum:["active","archived"]}).default("active"),createdAt:(0,i.nd)("created_at",{mode:"timestamp_ms"}).default((0,o.ll)`CURRENT_TIMESTAMP`)}),m=(0,a.D)("kpis",{id:(0,s.Qq)("id").primaryKey(),goalId:(0,s.Qq)("goal_id").notNull().references(()=>p.id),title:(0,s.Qq)("title").notNull(),description:(0,s.Qq)("description"),ownerId:(0,s.Qq)("owner_id").notNull().references(()=>l.id),targetValue:(0,n.x)("target_value").notNull(),unit:(0,s.Qq)("unit").notNull(),direction:(0,s.Qq)("direction",{enum:["up","down"]}).notNull(),frequency:(0,s.Qq)("frequency",{enum:["daily","weekly","monthly"]}).notNull(),weight:(0,n.x)("weight").default(1),status:(0,s.Qq)("status",{enum:["active","archived"]}).default("active"),createdAt:(0,i.nd)("created_at",{mode:"timestamp_ms"}).default((0,o.ll)`CURRENT_TIMESTAMP`)}),f=(0,a.D)("kpi_updates",{id:(0,s.Qq)("id").primaryKey(),kpiId:(0,s.Qq)("kpi_id").notNull().references(()=>m.id),value:(0,n.x)("value").notNull(),note:(0,s.Qq)("note"),recordedAt:(0,i.nd)("recorded_at",{mode:"timestamp_ms"}).notNull(),createdBy:(0,s.Qq)("created_by").notNull().references(()=>l.id)}),q=(0,d.K1)(p,({one:e,many:t})=>({team:e(u,{fields:[p.teamId],references:[u.id]}),owner:e(l,{fields:[p.ownerId],references:[l.id]}),kpis:t(m)})),g=(0,d.K1)(m,({one:e,many:t})=>({goal:e(p,{fields:[m.goalId],references:[p.id]}),owner:e(l,{fields:[m.ownerId],references:[l.id]}),updates:t(f)})),y=(0,d.K1)(f,({one:e})=>({kpi:e(m,{fields:[f.kpiId],references:[m.id]}),creator:e(l,{fields:[f.createdBy],references:[l.id]})})),N=(0,d.K1)(c,({one:e})=>({team:e(u,{fields:[c.teamId],references:[u.id]}),user:e(l,{fields:[c.userId],references:[l.id]})}))},49814:(e,t,r)=>{"use strict";r.d(t,{Co:()=>o,LE:()=>n});var a=r(45618),s=r(68919);let i={A:"user_a"};async function n(){return i.A}async function o(e,t){let r=await e.query.teamMembers.findFirst({where:(0,s.eq)(a.teamMembers.userId,t)});return r?r.teamId:"team_default"}},14937:(e,t,r)=>{"use strict";let a,s;r.d(t,{Ak:()=>n});let i=require("node:crypto");function n(e=21){var t;t=e|=0,!a||a.length<t?(a=Buffer.allocUnsafe(128*t),i.webcrypto.getRandomValues(a),s=0):s+t>a.length&&(i.webcrypto.getRandomValues(a),s=0),s+=t;let r="";for(let t=s-e;t<s;t++)r+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&a[t]];return r}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[442,928,87,388],()=>r(98348));module.exports=a})();