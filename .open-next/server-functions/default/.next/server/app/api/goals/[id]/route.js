(()=>{var e={};e.id=708,e.ids=[708],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},88502:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>v,routeModule:()=>f,serverHooks:()=>w,workAsyncStorage:()=>q,workUnitAsyncStorage:()=>g});var a={};r.r(a),r.d(a,{GET:()=>p,PATCH:()=>m});var s=r(75224),i=r(91133),n=r(65612),d=r(72529),o=r(23625),u=r(45618),l=r(49814),c=r(68919);async function p(e,{params:t}){try{let{id:e}=await t,r=await (0,l.LE)(),a=process.env,s=(0,o.L)(a.DB),i=await (0,l.Co)(s,r),n=await s.query.goals.findFirst({where:(0,c.eq)(u.goals.id,e),with:{kpis:!0}});if(!n)return d.NextResponse.json({error:"Goal not found"},{status:404});if(n.teamId!==i)return d.NextResponse.json({error:"Forbidden"},{status:403});return d.NextResponse.json({goal:n})}catch(e){return console.error("GET /api/goals/:id error:",e),d.NextResponse.json({error:"Failed to fetch goal"},{status:500})}}async function m(e,{params:t}){try{let{id:r}=await t,a=await e.json(),s=await (0,l.LE)(),i=process.env,n=(0,o.L)(i.DB),p=await (0,l.Co)(n,s),m=await n.query.goals.findFirst({where:(0,c.eq)(u.goals.id,r)});if(!m)return d.NextResponse.json({error:"Goal not found"},{status:404});if(m.teamId!==p)return d.NextResponse.json({error:"Forbidden"},{status:403});let f={};return void 0!==a.title&&(f.title=a.title),void 0!==a.description&&(f.description=a.description),void 0!==a.targetValue&&(f.targetValue=Number(a.targetValue)),void 0!==a.unit&&(f.unit=a.unit),void 0!==a.dueDate&&(f.dueDate=a.dueDate?Number(a.dueDate):null),void 0!==a.status&&(f.status=a.status),void 0!==a.ownerId&&(f.ownerId=a.ownerId),await n.update(u.goals).set(f).where((0,c.eq)(u.goals.id,r)),d.NextResponse.json({ok:!0})}catch(e){return console.error("PATCH /api/goals/:id error:",e),d.NextResponse.json({error:"Failed to update goal"},{status:500})}}let f=new s.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/goals/[id]/route",pathname:"/api/goals/[id]",filename:"route",bundlePath:"app/api/goals/[id]/route"},resolvedPagePath:"/Users/kawashimariku/Desktop/KPI管理/src/app/api/goals/[id]/route.ts",nextConfigOutput:"standalone",userland:a}),{workAsyncStorage:q,workUnitAsyncStorage:g,serverHooks:w}=f;function v(){return(0,n.patchFetch)({workAsyncStorage:q,workUnitAsyncStorage:g})}},84455:()=>{},14719:()=>{},23625:(e,t,r)=>{"use strict";r.d(t,{L:()=>i});var a=r(66388),s=r(45618);function i(e){return(0,a.f)(e,{schema:s})}},45618:(e,t,r)=>{"use strict";r.r(t),r.d(t,{goals:()=>p,goalsRelations:()=>q,kpiUpdates:()=>f,kpiUpdatesRelations:()=>w,kpis:()=>m,kpisRelations:()=>g,teamMembers:()=>c,teamMembersRelations:()=>v,teams:()=>l,users:()=>u});var a=r(16620),s=r(18762),i=r(42787),n=r(5737),d=r(18884),o=r(75888);let u=(0,a.D)("users",{id:(0,s.Qq)("id").primaryKey(),email:(0,s.Qq)("email").notNull().unique(),name:(0,s.Qq)("name").notNull(),avatarUrl:(0,s.Qq)("avatar_url"),createdAt:(0,i.nd)("created_at",{mode:"timestamp_ms"}).default((0,d.ll)`CURRENT_TIMESTAMP`)}),l=(0,a.D)("teams",{id:(0,s.Qq)("id").primaryKey(),name:(0,s.Qq)("name").notNull(),createdAt:(0,i.nd)("created_at",{mode:"timestamp_ms"}).default((0,d.ll)`CURRENT_TIMESTAMP`)}),c=(0,a.D)("team_members",{id:(0,s.Qq)("id").primaryKey(),teamId:(0,s.Qq)("team_id").notNull().references(()=>l.id),userId:(0,s.Qq)("user_id").notNull().references(()=>u.id),role:(0,s.Qq)("role",{enum:["owner","member"]}).notNull()}),p=(0,a.D)("goals",{id:(0,s.Qq)("id").primaryKey(),teamId:(0,s.Qq)("team_id").notNull().references(()=>l.id),title:(0,s.Qq)("title").notNull(),description:(0,s.Qq)("description"),ownerId:(0,s.Qq)("owner_id").notNull().references(()=>u.id),targetValue:(0,n.x)("target_value").notNull(),unit:(0,s.Qq)("unit").notNull(),dueDate:(0,i.nd)("due_date"),status:(0,s.Qq)("status",{enum:["active","archived"]}).default("active"),createdAt:(0,i.nd)("created_at",{mode:"timestamp_ms"}).default((0,d.ll)`CURRENT_TIMESTAMP`)}),m=(0,a.D)("kpis",{id:(0,s.Qq)("id").primaryKey(),goalId:(0,s.Qq)("goal_id").notNull().references(()=>p.id),title:(0,s.Qq)("title").notNull(),description:(0,s.Qq)("description"),ownerId:(0,s.Qq)("owner_id").notNull().references(()=>u.id),targetValue:(0,n.x)("target_value").notNull(),unit:(0,s.Qq)("unit").notNull(),direction:(0,s.Qq)("direction",{enum:["up","down"]}).notNull(),frequency:(0,s.Qq)("frequency",{enum:["daily","weekly","monthly"]}).notNull(),weight:(0,n.x)("weight").default(1),status:(0,s.Qq)("status",{enum:["active","archived"]}).default("active"),createdAt:(0,i.nd)("created_at",{mode:"timestamp_ms"}).default((0,d.ll)`CURRENT_TIMESTAMP`)}),f=(0,a.D)("kpi_updates",{id:(0,s.Qq)("id").primaryKey(),kpiId:(0,s.Qq)("kpi_id").notNull().references(()=>m.id),value:(0,n.x)("value").notNull(),note:(0,s.Qq)("note"),recordedAt:(0,i.nd)("recorded_at",{mode:"timestamp_ms"}).notNull(),createdBy:(0,s.Qq)("created_by").notNull().references(()=>u.id)}),q=(0,o.K1)(p,({one:e,many:t})=>({team:e(l,{fields:[p.teamId],references:[l.id]}),owner:e(u,{fields:[p.ownerId],references:[u.id]}),kpis:t(m)})),g=(0,o.K1)(m,({one:e,many:t})=>({goal:e(p,{fields:[m.goalId],references:[p.id]}),owner:e(u,{fields:[m.ownerId],references:[u.id]}),updates:t(f)})),w=(0,o.K1)(f,({one:e})=>({kpi:e(m,{fields:[f.kpiId],references:[m.id]}),creator:e(u,{fields:[f.createdBy],references:[u.id]})})),v=(0,o.K1)(c,({one:e})=>({team:e(l,{fields:[c.teamId],references:[l.id]}),user:e(u,{fields:[c.userId],references:[u.id]})}))},49814:(e,t,r)=>{"use strict";r.d(t,{Co:()=>d,LE:()=>n});var a=r(45618),s=r(68919);let i={A:"user_a"};async function n(){return i.A}async function d(e,t){let r=await e.query.teamMembers.findFirst({where:(0,s.eq)(a.teamMembers.userId,t)});return r?r.teamId:"team_default"}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[442,928,87,388],()=>r(88502));module.exports=a})();